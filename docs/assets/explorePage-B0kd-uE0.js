/* empty css                  *//* empty css                     */import{e as t}from"./equip-eJVsYbcZ.js";import{a as e}from"./achievement-D7rAOyFA.js";import{_ as s,c as a,e as i,a as n,t as o,b as h,w as r,k as l,l as m,C as p,E as c,o as d,F as u,m as y}from"./index-C3HF_ROH.js";const f={monster_Names(t){const e=["影魅狸奴","幽谷灵蛇","雾隐狐仙","松间灵猴","月影蝠妖","山涧蛟童","林涧鹿灵","岩隙石精","风鸣鹤怪","翠竹蛙仙"],s=["青龙啸天","白虎破晓","朱雀焚翼","玄武镇海","麒麟踏瑞","凤凰涅槃","毕方炽焰","貔貅吞金","白泽知世","狻猊御火"],a=["伏羲天帝","女娲圣母","昊天玉皇","太上老君","东华帝君","西王母后","神农炎帝","轩辕黄帝","瑶姬仙子","真武大帝"],i=["混沌始元尊","乾坤造物主","宇宙创生神","万灵始祖皇","鸿蒙创世者","无极造化君","太虚衍化神","元始天尊祖","虚空造物圣","界域开辟者"];return t>=1&&t<=19?e[Math.floor(Math.random()*e.length)]:t>=20&&t<=49?s[Math.floor(Math.random()*s.length)]:t>=50&&t<=100?a[Math.floor(Math.random()*a.length)]:i[Math.floor(Math.random()*a.length)]},monster_Attack(t){return t<=144?this.getRandomInt(50,150)*t:this.getRandomInt(1e4,5e4)*t},monster_Health(t){return t<=144?this.getRandomInt(100,500)*t:this.getRandomInt(1e4,5e4)*t},monster_Defense(t){return t<=144?this.getRandomInt(1,15)*t:this.getRandomInt(500,1e3)*t},monster_Criticalhitrate(t){return t<=144?this.getRandomFloatInRange(.001,.01):this.getRandomFloatInRange(.1,.75)},getRandomInt:(t,e)=>(t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t),getRandomFloatInRange:(t,e)=>Math.random()*(e-t)+t},g={class:"cultivate"},v={class:"storyText"},$={class:"storyText-box"},x={key:0,class:"fighting"},M=["innerHTML"],R={class:"actions"},k={class:"action"},I={class:"action"},C={class:"action"},F={class:"action"},b={class:"action"};const _=s({data:()=>({texts:[],isEnd:!1,player:{},monster:{},victory:!1,timerIds:[],isFighting:!1,guashaRounds:10,isFailedRetreat:!1,isCaptureFailed:!1,openEquipItemInfo:{}}),beforeDestroy(){this.stopFight()},mounted(){this.player=this.$store.state.player,this.encounterMonster()},methods:{goHome(){this.$store.state.mapData={y:0,x:0,map:[]},this.$router.push("/home")},openMonsterInfo(){const t=this.calculateCaptureRate(),e=.5*(100-t);this.$alert("",this.monster.name,{center:!0,message:`<div class="monsterinfo">\n                        <div class="monsterinfo-box">\n                            <p>境界: ${0==this.player.level?this.$levelNames(this.player.level+1):this.$levelNames(this.player.level)}</p>\n                            <p>悟性: ${Math.floor(e)}</p>\n                            <p>气血: ${this.$formatNumberToChineseUnit(this.monster.health)}</p>\n                            <p>攻击: ${this.$formatNumberToChineseUnit(this.monster.attack)}</p>\n                            <p>防御: ${this.$formatNumberToChineseUnit(this.monster.defense)}</p>\n                            <p>闪避率: ${this.monster.dodge>0?100*this.monster.dodge>100?100:(100*this.monster.dodge).toFixed(2):0}%</p>\n                            <p>暴击率: ${this.monster.critical>0?100*this.monster.critical>100?100:(100*this.monster.critical).toFixed(2):0}%</p>\n                            <p>收服率: ${t}%</p>\n                        </div>\n                    </div>`,confirmButtonText:"知道了",dangerouslyUseHTMLString:!0}).catch((()=>{}))},startFight(){if(this.isEnd)return;this.isEnd=!0,this.victory=!1;const t=10*player.reincarnation,e=setInterval((()=>{this.fightMonster();const t=this.$refs.scrollbar.wrapRef;new MutationObserver((()=>{this.$smoothScrollToBottom(t)})).observe(t,{childList:!0,subtree:!0})}),t>=200?100:300-t);this.timerIds.push(e)},stopFight(){this.timerIds.forEach((t=>{clearInterval(t)})),this.isEnd=!0,this.timerIds=[],this.isFailedRetreat=!0,this.isCaptureFailed=!0},fightMonster(){if(this.isFighting=!0,this.monster.health<=0)return;const t=this.monster.attack,e=this.player.defense;let s=Math.max(0,Math.floor(t-e));s=s<=1?1:s;const a=this.player.attack,i=this.monster.defense;let n=Math.max(0,Math.floor(a-i));n=n<=1?1:n;let o=!1,h=!1;const r=Math.random()>this.player.dodge,l=Math.random()>this.monster.dodge;if(Math.random()<this.monster.critical&&(s*=2,o=!0),Math.random()<this.player.critical&&(n*=1.5,h=!0),r&&(this.player.health-=s),l&&(this.monster.health-=n),this.player.health=Math.max(0,this.player.health),this.monster.health=Math.max(0,this.monster.health),this.guashaRounds>1)if(this.guashaRounds--,this.monster.health<=0){this.player.taskNum++;const t=this.player.reincarnation?1+1*this.player.reincarnation:1;this.player.props.cultivateDan+=t,this.texts=[...this.texts,`击败${this.monster.name}后你获得了${t}颗培养丹`],this.findTreasure(this.monster.name),this.stopFight()}else this.player.health<=0?(this.texts=[...this.texts,"你因为太弱被击败了。"],this.stopFight()):(this.texts=[...this.texts,l?`你攻击了${this.monster.name}，${h?"触发暴击":""}造成了${n}点伤害，剩余${this.monster.health}气血。`:`你攻击了${this.monster.name}，对方闪避了你的攻击，你未造成伤害，剩余${this.monster.health}气血。`],this.texts=[...this.texts,r?`${this.monster.name}攻击了你，${o?"触发暴击":""}造成了${s}点伤害`:`${this.monster.name}攻击了你，你闪避了对方的攻击，对方未造成伤害。`]);else this.guashaRounds=10,this.texts=[...this.texts,`回合结束, 你未战胜${this.monster.name}你输了。`],this.stopFight();this.$store.commit("setPlayer",this.player)},runAway(){this.guashaRounds--,t.getRandomInt(0,1)?(this.isFailedRetreat=!0,this.texts=[...this.texts,"撤退失败，继续战斗。"]):(this.guashaRounds=10,this.$router.push("/map"),this.$notifys({title:"提示",message:"你选择了撤退。"}))},findTreasure(){let e={},s=Math.floor(this.player.maxCultivation/100);s=s||1,this.victory=!0;const a=t.getRandomInt(1,4);if(1==a?e=t.equip_Weapons(this.player.level):2==a?e=t.equip_Armors(this.player.level):3==a?e=t.equip_Accessorys(this.player.level):4==a&&(e=t.equip_Sutras(this.player.level)),this.texts=[...this.texts,`你击败${this.monster.name}后，发现了一个宝箱，打开后获得了<span class="el-tag el-tag--${e.quality}">${this.$levels[e.quality]}${e.name}(${this.$genre[e.type]})</span>`],this.openEquipItemInfo=e,this.player.inventory.length>=this.player.backpackCapacity?this.texts=[...this.texts,"当前装备背包容量已满, 该装备自动丢弃, 转生可增加背包容量"]:this.player.inventory.push(e),this.player.level<this.$maxLv)if(this.player.level<this.$maxLv)if(this.player.cultivation>=this.player.maxCultivation){if(this.player.level>10&&this.player.level>this.player.taskNum)return void(this.texts=[...this.texts,`当前境界修为已满, 你需要通过击败<span style="color: #f56c6c;">(${this.player.taskNum} / ${this.player.level})</span>个敌人证道突破`]);this.player.taskNum=0,this.player.level++,this.player.points+=3,this.player.health=this.player.maxHealth,this.player.maxCultivation=Math.floor(100*Math.pow(2,this.player.level)),this.texts=[...this.texts,`恭喜你突破了！当前境界：${this.$levelNames(this.player.level)}`]}else this.player.cultivation+=s;else this.isStop=!1,this.isStart=!1,this.player.level=this.$maxLv,this.player.maxCultivation=Math.floor(100*Math.pow(2,this.$maxLv)),this.texts=[...this.texts,"你当前的境界已修炼圆满, 需要转生后才能继续修炼"];this.$store.commit("setPlayer",this.player)},openEquipmentInfo(t){this.victory&&this.$confirm("",t.name,{center:!0,message:`<div class="monsterinfo">\n                        <div class="monsterinfo-box">\n                            <p>类型: ${this.$genre[t.type]??"未知"}</p>\n                            <p>境界: ${this.$levelNames(t.level)}</p>\n                            <p>品质: ${this.$levels[t.quality]??"未知"}</p>\n                            <p>气血: ${this.$formatNumberToChineseUnit(t.health)}</p>\n                            <p>攻击: ${this.$formatNumberToChineseUnit(t.attack)}</p>\n                            <p>防御: ${this.$formatNumberToChineseUnit(t.defense)}</p>\n                            <p>闪避率: ${(100*t.dodge).toFixed(2)??0}%</p>\n                            <p>暴击率: ${(100*t.critical).toFixed(2)??0}%</p>\n                        </div>\n                    </div>`,showCancelButton:!1,confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).catch((()=>{}))},encounterMonster(){let t=0==this.player.level?1:this.player.level;const e=t*this.player.reincarnation+t;this.monster={name:f.monster_Names(e),health:f.monster_Health(e),attack:f.monster_Attack(e),defense:f.monster_Defense(e),dodge:f.monster_Criticalhitrate(e),critical:f.monster_Criticalhitrate(e)}},harvestPet(s){this.isCaptureFailed=!0;const a=this.calculateCaptureRate();if(this.player.backpackCapacity>this.player.pets.length){const i=Math.floor(.5*(100-a)),n=Math.floor(f.getRandomInt(50,150)*i),o=Math.floor(f.getRandomInt(1,15)*i),h=Math.floor(f.getRandomInt(100,500)*i),r=parseFloat(f.getRandomFloatInRange(.001,.01)*i),l=parseFloat(f.getRandomFloatInRange(.001,.01)*i);this.player.pets.push({id:Date.now(),lock:!1,name:s.name,level:1,score:t.calculateEquipmentScore(r,n,h,l,o),dodge:r,health:h,attack:n,defense:o,critical:l,initial:{dodge:r,health:h,attack:n,defense:o,critical:l,rootBone:i},rootBone:i,favorability:0,reincarnation:0});const m=this.player.achievement.pet,p=t=>{const e=t.condition;return(0===e.health||e.health<=h)&&(0===e.attack||e.attack<=n)&&(0===e.defense||e.defense<=o)&&(0===e.dodge||e.dodge<=r.toFixed(2))&&(0===e.critical||e.critical<=l.toFixed(2))};e.pet().forEach((t=>{p(t)&&!m.find((e=>e.id===t.id))&&(this.player.achievement.pet.push({id:t.id}),this.player.props.cultivateDan+=t.award,this.notify({title:"获得成就提示",message:`恭喜你完成了${t.name}成就`}))})),this.texts=[...this.texts,`收服${s.name}成功`],this.$store.commit("setPlayer",this.player)}else this.texts=[...this.texts,`灵宠背包容量已满, 收服${s.name}失败, 转生可增加灵宠背包容量`];this.guashaRounds=10,this.stopFight()},calculateCaptureRate(){let t=100*Math.pow(.98,this.player.level);return t=Math.floor(Math.max(0,Math.min(100,t))),t}}},[["render",function(t,e,s,f,_,T){const E=p,N=c;return d(),a("div",g,[e[9]||(e[9]=i(" 你遇到了")),n("span",{class:"el-tag el-tag--danger",onClick:e[0]||(e[0]=(...t)=>T.openMonsterInfo&&T.openMonsterInfo(...t))},o(_.monster.name),1),n("div",v,[n("div",$,[h(E,{ref:"scrollbar",always:""},{default:r((()=>[_.isFighting?(d(),a("p",x,o(_.guashaRounds)+"回合 / 10回合 ",1)):m("",!0),(d(!0),a(u,null,y(_.texts,((t,s)=>(d(),a("p",{key:s,innerHTML:t,onClick:e[1]||(e[1]=t=>T.openEquipmentInfo(_.openEquipItemInfo))},null,8,M)))),128))])),_:1},512)])]),n("div",R,[n("div",k,[h(N,{class:"item",onClick:T.startFight,disabled:_.isEnd},{default:r((()=>e[4]||(e[4]=[i(" 发起战斗 ")]))),_:1},8,["onClick","disabled"])]),n("div",I,[h(N,{class:"item",onClick:e[2]||(e[2]=t=>T.harvestPet(_.monster)),disabled:_.isCaptureFailed},{default:r((()=>e[5]||(e[5]=[i(" 收服对方 ")]))),_:1},8,["disabled"])]),n("div",C,[h(N,{class:"item",onClick:T.runAway,disabled:_.isFailedRetreat},{default:r((()=>e[6]||(e[6]=[i(" 立马撤退 ")]))),_:1},8,["onClick","disabled"])]),n("div",F,[_.isEnd?(d(),l(N,{key:0,class:"item",onClick:e[3]||(e[3]=e=>t.$router.push("/map")),disabled:_.player.health<=0},{default:r((()=>e[7]||(e[7]=[i(" 继续探索 ")]))),_:1},8,["disabled"])):m("",!0)]),n("div",b,[_.isEnd?(d(),l(N,{key:0,class:"item",onClick:T.goHome},{default:r((()=>e[8]||(e[8]=[i(" 回家疗伤 ")]))),_:1},8,["onClick"])):m("",!0)])])])}],["__scopeId","data-v-339baf71"]]);export{_ as default};
